{% extends "base.html" %}
{% load static %}

{% block title %}Academic Calendar Timeline{% endblock %}

{% block extra_css %}
<style>
    .timeline-container {
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(10px);
        border-radius: 12px;
        padding: 24px;
        margin-bottom: 24px;
    }

    .year-block {
        border-left: 4px solid #667eea;
        padding: 16px;
        margin-bottom: 20px;
        background: rgba(102, 126, 234, 0.05);
        border-radius: 8px;
    }

    .year-block.active {
        border-left: 4px solid #38ef7d;
        background: rgba(56, 239, 125, 0.05);
    }

    .year-title {
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .active-badge {
        display: inline-block;
        background: #38ef7d;
        color: white;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
    }

    .term-row {
        display: grid;
        grid-template-columns: 80px 1fr 1fr 100px 120px;
        gap: 12px;
        padding: 12px;
        background: white;
        border-radius: 8px;
        margin-bottom: 8px;
        align-items: center;
    }

    .term-number {
        font-weight: bold;
        padding: 8px 12px;
        background: #667eea;
        color: white;
        border-radius: 6px;
        text-align: center;
    }

    .date-range {
        font-size: 13px;
        color: #666;
    }

    .fee-amount {
        font-size: 16px;
        font-weight: bold;
        color: #38ef7d;
    }

    .progress-indicator {
        height: 4px;
        background: #e5e7eb;
        border-radius: 2px;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #667eea, #764ba2);
        width: 0%;
    }

    .progress-fill.completed {
        width: 100%;
        background: #38ef7d;
    }

    .progress-fill.in-progress {
        width: 50%;
        background: #f59e0b;
    }

    .days-until {
        font-size: 12px;
        color: #999;
        text-align: right;
    }

    .days-until.upcoming {
        color: #f59e0b;
        font-weight: 600;
    }

    .days-until.current {
        color: #38ef7d;
        font-weight: 600;
    }

    h1 {
        color: #1f2937;
        margin-bottom: 24px;
    }

    .legend {
        display: flex;
        gap: 24px;
        margin-top: 24px;
        padding: 16px;
        background: rgba(0, 0, 0, 0.02);
        border-radius: 8px;
    }

    .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
    }

    .legend-color {
        width: 12px;
        height: 12px;
        border-radius: 50%;
    }

    .legend-color.active {
        background: #38ef7d;
    }

    .legend-color.upcoming {
        background: #667eea;
    }

    .legend-color.past {
        background: #d1d5db;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <h1>ðŸ“… Academic Calendar Timeline</h1>

    <div class="legend">
        <div class="legend-item">
            <div class="legend-color active"></div>
            <span>Active Year</span>
        </div>
        <div class="legend-item">
            <div class="legend-color upcoming"></div>
            <span>Upcoming Year</span>
        </div>
        <div class="legend-item">
            <div class="legend-color past"></div>
            <span>Past Year</span>
        </div>
    </div>

    {% for year in academic_years %}
    <div class="timeline-container year-block {% if year.is_active %}active{% endif %}">
        <div class="year-title">
            Academic Year {{ year.year }}
            {% if year.is_active %}
            <span class="active-badge">ACTIVE</span>
            {% endif %}
        </div>
        
        <p style="font-size: 13px; color: #666; margin-bottom: 16px;">
            {{ year.start_date|date:"F d, Y" }} â€“ {{ year.end_date|date:"F d, Y" }}
        </p>

        <div style="margin-top: 12px;">
            {% for term in year.terms %}
            <div class="term-row">
                <div class="term-number">T{{ term.term_num }}</div>
                
                <div class="date-range">
                    {{ term.start_date|date:"M d" }} â€“ {{ term.end_date|date:"M d" }}
                </div>
                
                <div class="progress-indicator">
                    {% if term.is_current %}
                        <div class="progress-fill in-progress"></div>
                    {% elif term.start_date < today %}
                        <div class="progress-fill completed"></div>
                    {% endif %}
                </div>
                
                <div class="fee-amount">${{ term.fee|floatformat:2 }}</div>
                
                <div class="days-until {% if term.is_current %}current{% elif term.days_until_start > 0 %}upcoming{% endif %}">
                    {% if term.is_current %}
                        IN PROGRESS
                    {% elif term.days_until_start > 0 %}
                        In {{ term.days_until_start }} days
                    {% else %}
                        Completed
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endfor %}

    <div class="timeline-container" style="text-align: center; color: #999;">
        <p>Showing academic years {{ academic_years.first.year }} - {{ academic_years.last.year }}</p>
    </div>
</div>

<script>
    // Timeline data loaded from context
    const timelineData = {{ timeline_json|safe }};
    console.log('Timeline data:', timelineData);
</script>
{% endblock %}
