{% extends 'base.html' %}
{% load static %}

{% block title %}Students - School Management System{% endblock %}

{% block content %}
<div class="min-h-screen pt-24 pb-12 px-6 bg-gradient-to-br from-slate-900 via-slate-900 to-slate-800">
    <!-- Background Gradient -->
    <div class="fixed inset-0 z-0 pointer-events-none">
        <div class="absolute top-0 right-0 w-96 h-96 bg-emerald-500/10 rounded-full blur-3xl"></div>
        <div class="absolute bottom-0 left-0 w-96 h-96 bg-cyan-500/10 rounded-full blur-3xl"></div>
    </div>

    <div class="max-w-7xl mx-auto relative z-10">
        <!-- Header with Navigation -->
        <div class="mb-12 animate-slideInUp">
            <div class="flex justify-between items-start mb-6">
                <div>
                    <h1 class="text-5xl font-bold bg-gradient-to-r from-emerald-300 via-cyan-300 to-blue-300 bg-clip-text text-transparent mb-3">Student Management</h1>
                    <p class="text-slate-400 text-lg">Manage and monitor all enrolled students</p>
                </div>
            </div>
            
            <!-- Navigation Tabs -->
            <div class="flex gap-3 mb-6 flex-wrap">
                <a href="{% url 'student_list' %}" class="px-6 py-2 rounded-lg bg-emerald-600 text-white font-semibold hover:bg-emerald-700 transition-colors">
                    üìö Active Students
                </a>
                <a href="{% url 'graduated_with_arrears' %}" class="px-6 py-2 rounded-lg bg-orange-600 text-white font-semibold hover:bg-orange-700 transition-colors">
                    ‚ö†Ô∏è Graduated with Arrears
                </a>
                <a href="{% url 'archived_students' %}" class="px-6 py-2 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 transition-colors">
                    üéì Alumni
                </a>
            </div>
        </div>

        <!-- Search & Filter Bar -->
        <div class="glass rounded-2xl p-6 mb-8 border border-slate-500/20 animate-slideInUp" style="animation-delay: 0.1s;">
            <form method="get" class="flex flex-col md:flex-row gap-4 items-end mb-4">
                <div class="flex-1">
                    <label class="block text-sm font-medium text-slate-300 mb-2">Search</label>
                    <input type="text" name="search" placeholder="Search by name or ID..." 
                           value="{{ request.GET.search }}"
                           class="w-full px-4 py-2.5 rounded-lg bg-slate-800/50 border border-slate-600/50 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent transition-all">
                </div>
                <div class="w-full md:w-auto">
                    <label class="block text-sm font-medium text-slate-300 mb-2">Class</label>
                    <select name="class" class="w-full px-4 py-2.5 rounded-lg bg-slate-800/50 border border-slate-600/50 text-white focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent">
                        <option value="">All Classes</option>
                        {% for class in classes %}
                        <option value="{{ class.id }}" {% if request.GET.class|add:"0" == class.id|add:"0" %}selected{% endif %}>Grade {{ class.grade }}{{ class.section }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="w-full md:w-auto">
                    <label class="block text-sm font-medium text-slate-300 mb-2">Gender</label>
                    <select name="sex" class="w-full px-4 py-2.5 rounded-lg bg-slate-800/50 border border-slate-600/50 text-white focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent">
                        <option value="">All Genders</option>
                        <option value="M" {% if request.GET.sex == 'M' %}selected{% endif %}>Male</option>
                        <option value="F" {% if request.GET.sex == 'F' %}selected{% endif %}>Female</option>
                    </select>
                </div>
                <div class="w-full md:w-auto">
                    <label class="block text-sm font-medium text-slate-300 mb-2">Balance</label>
                    <select name="balance" class="w-full px-4 py-2.5 rounded-lg bg-slate-800/50 border border-slate-600/50 text-white focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:border-transparent">
                        <option value="">All Balances</option>
                        <option value="paid" {% if request.GET.balance == 'paid' %}selected{% endif %}>Fully Paid</option>
                        <option value="partial" {% if request.GET.balance == 'partial' %}selected{% endif %}>Partial Payment</option>
                        <option value="unpaid" {% if request.GET.balance == 'unpaid' %}selected{% endif %}>Outstanding</option>
                    </select>
                </div>
                <button type="submit" class="w-full md:w-auto px-6 py-2.5 rounded-lg font-semibold text-white bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 hover:shadow-xl hover:shadow-blue-500/30 transition-all">
                    Search
                </button>
                <a href="{% url 'student_list' %}" class="w-full md:w-auto px-6 py-2.5 rounded-lg font-semibold text-white bg-slate-700 hover:bg-slate-600 transition-all text-center">
                    Clear
                </a>
            </form>
            <div class="flex flex-col md:flex-row gap-4 items-center">
                <button type="button" id="addStudentBtn" class="w-full md:w-auto px-6 py-2.5 rounded-lg font-semibold text-white bg-gradient-to-r from-emerald-500 to-cyan-500 hover:from-emerald-600 hover:to-cyan-600 hover:shadow-xl hover:shadow-emerald-500/30 transition-all transform hover:scale-105 active:scale-95 inline-flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                    Add Student
                </button>
            </div>
        </div>

        <!-- Students Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 animate-fadeIn">
            {% for student in students %}
            <div class="group student-card glass rounded-2xl border border-emerald-500/30 hover:border-emerald-500/60 transition-all duration-300 overflow-hidden p-6">
                <div class="absolute inset-0 bg-gradient-to-br from-emerald-500/5 to-cyan-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300 -z-10"></div>

                <!-- Badge Section -->
                <div class="flex items-center justify-between mb-4">
                    <span class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-gradient-to-r from-emerald-500/20 to-cyan-500/20 border border-emerald-500/30 text-emerald-300 text-xs font-bold uppercase tracking-wider">
                        <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20"><path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/></svg>
                        Student
                    </span>
                    <span class="text-emerald-400 text-xs font-bold">ID: {{ student.birth_entry_number }}</span>
                </div>

                <!-- Student Name and Info -->
                <div class="mb-4 pb-4 border-b border-slate-700/50">
                    <h3 class="text-xl font-bold text-slate-100 mb-1">{{ student.full_name }}</h3>
                    <p class="text-slate-400 text-sm">Age: {{ student.age }} years</p>
                </div>

                <!-- Info Grid -->
                <div class="grid grid-cols-2 gap-3 text-sm mb-4">
                    <div>
                        <p class="text-slate-500 text-xs uppercase tracking-wide">Class</p>
                        <p class="text-slate-200 font-semibold">
                            {% if student.current_class %}
                                Gr {{ student.current_class.grade }}{{ student.current_class.section }}
                            {% else %}
                                ‚Äî
                            {% endif %}
                        </p>
                    </div>
                    <div>
                        <p class="text-slate-500 text-xs uppercase tracking-wide">Gender</p>
                        <p class="text-slate-200 font-semibold">{{ student.get_sex_display|first }}</p>
                    </div>
                </div>

                <!-- Balance Box -->
                <div class="bg-gradient-to-r {% if student.overall_balance == 0 %}from-emerald-500/10 to-teal-500/10{% else %}from-red-500/10 to-orange-500/10{% endif %} rounded-lg p-3 mb-4 border {% if student.overall_balance == 0 %}border-emerald-500/30{% else %}border-red-500/30{% endif %}">
                    <p class="text-slate-500 text-xs uppercase tracking-wide mb-1">Outstanding Balance</p>
                    <p class="text-slate-200 text-lg font-bold">
                        {% if student.overall_balance == 0 %}
                            <span class="text-emerald-400">‚úì Fully Paid</span>
                        {% else %}
                            <span class="{% if student.overall_balance > 0 %}text-red-400{% else %}text-emerald-400{% endif %}">
                                ${{ student.overall_balance|floatformat:2|default:"0.00" }}
                            </span>
                        {% endif %}
                    </p>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-col gap-2 pt-4 border-t border-slate-600/30">
                    <a href="{% url 'student_detail' pk=student.id %}" class="w-full inline-flex items-center justify-center gap-2 px-4 py-2 rounded-lg text-sm font-semibold text-emerald-300 bg-emerald-500/20 border border-emerald-500/30 hover:bg-emerald-500/30 transition-all">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                        View Profile
                    </a>
                    <div class="flex gap-2">
                        <a href="{% url 'student_update' pk=student.id %}" class="flex-1 inline-flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm font-semibold text-slate-300 bg-slate-700/50 border border-slate-600/50 hover:bg-slate-700 transition-all">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                            Edit
                        </a>
                        <a href="{% url 'student_delete' pk=student.id %}" class="flex-1 inline-flex items-center justify-center gap-2 px-3 py-2 rounded-lg text-sm font-semibold text-red-300 bg-red-500/20 border border-red-500/30 hover:bg-red-500/30 transition-all" onclick="return confirm('Delete this student?');">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                        </a>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-span-full">
                <div class="glass rounded-2xl p-16 text-center border border-slate-500/20 animate-slideInUp">
                    <div class="w-24 h-24 rounded-full bg-gradient-to-br from-emerald-500/20 to-cyan-500/20 border border-emerald-500/20 flex items-center justify-center mx-auto mb-6">
                        <svg class="w-12 h-12 text-emerald-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                        </svg>
                    </div>
                    <h3 class="text-3xl font-bold text-slate-100 mb-2">No Students Found</h3>
                    <p class="text-slate-400 mb-8 text-lg">Get started by adding your first student to the system</p>
                    <button type="button" onclick="document.getElementById('addStudentBtn').click()" 
                            class="px-8 py-3 rounded-xl font-semibold text-white bg-gradient-to-r from-emerald-500 to-cyan-500 hover:from-emerald-600 hover:to-cyan-600 hover:shadow-xl hover:shadow-emerald-500/30 transition-all">
                        Add First Student
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<script>
    // Add student handler
    document.getElementById('addStudentBtn').addEventListener('click', function() {
        window.location.href = '{% url "student_create" %}';
    });
</script>

<!-- Pagination -->
<div class="mt-12 flex flex-col md:flex-row gap-6 items-center justify-between">
    <div class="text-slate-400">
        {% if page_obj %}
            Showing page <strong>{{ page_obj.number }}</strong> of <strong>{{ page_obj.paginator.num_pages }}</strong> 
            ({{ paginator.count|default:"0" }} results)
        {% else %}
            No students found
        {% endif %}
    </div>
    
    {% if is_paginated %}
    <nav class="flex gap-2">
        {% if page_obj.has_previous %}
        <a href="?page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.class %}&class={{ request.GET.class }}{% endif %}{% if request.GET.sex %}&sex={{ request.GET.sex }}{% endif %}{% if request.GET.balance %}&balance={{ request.GET.balance }}{% endif %}" 
           class="px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-white transition-all">First</a>
        <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.class %}&class={{ request.GET.class }}{% endif %}{% if request.GET.sex %}&sex={{ request.GET.sex }}{% endif %}{% if request.GET.balance %}&balance={{ request.GET.balance }}{% endif %}" 
           class="px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-white transition-all">Previous</a>
        {% endif %}
        
        {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
            <span class="px-4 py-2 rounded-lg bg-emerald-500 text-white font-bold">{{ num }}</span>
            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
            <a href="?page={{ num }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.class %}&class={{ request.GET.class }}{% endif %}{% if request.GET.sex %}&sex={{ request.GET.sex }}{% endif %}{% if request.GET.balance %}&balance={{ request.GET.balance }}{% endif %}" 
               class="px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-white transition-all">{{ num }}</a>
            {% endif %}
        {% endfor %}
        
        {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.class %}&class={{ request.GET.class }}{% endif %}{% if request.GET.sex %}&sex={{ request.GET.sex }}{% endif %}{% if request.GET.balance %}&balance={{ request.GET.balance }}{% endif %}" 
           class="px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-white transition-all">Next</a>
        <a href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.class %}&class={{ request.GET.class }}{% endif %}{% if request.GET.sex %}&sex={{ request.GET.sex }}{% endif %}{% if request.GET.balance %}&balance={{ request.GET.balance }}{% endif %}" 
           class="px-4 py-2 rounded-lg bg-slate-700 hover:bg-slate-600 text-white transition-all">Last</a>
        {% endif %}
    </nav>
    {% endif %}
</div>

{% endblock %}