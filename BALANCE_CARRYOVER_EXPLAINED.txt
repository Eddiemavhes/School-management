â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                    BALANCE CARRYOVER ON YEAR ROLLOVER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… BALANCES ARE PRESERVED ACROSS YEARS
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

HOW IT WORKS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

When rolling over from 2026 â†’ 2027:

1. CALCULATE ARREARS FOR EACH STUDENT
   For each student, the system calculates:
   
   Total Arrears = SUM of (Term Fee + Previous Arrears - Amount Paid)
                 for ALL terms in 2026
   
   Example - Audrey's 2026 Summary:
   â”œâ”€ Term 1: Fee $120 - Paid $50   = $70 outstanding
   â”œâ”€ Term 2: Fee $200 - Paid $200  = $0 outstanding
   â””â”€ Term 3: Fee $180 - Paid $100  = $80 outstanding
   
   TOTAL ARREARS = $70 + $0 + $80 = $150

2. CREATE NEW ACADEMIC YEAR (2027)
   âœ“ Automatically creates 3 new terms
   âœ“ Copies fee structure from 2026
   âœ“ Creates all 14 classes (Grades 1-7, A & B)

3. PROMOTE STUDENTS
   âœ“ Each student moved from Grade X â†’ Grade X+1
   âœ“ Same section preserved (A stays A, B stays B)
   âœ“ Grade 7 students marked as graduating (inactive)

4. CARRY FORWARD ARREARS
   For first term of 2027:
   â”œâ”€ Term Fee: $120 (new year fee)
   â”œâ”€ Previous Arrears: $150 (from 2026)
   â””â”€ Amount Paid: $0 (new year, no payments yet)
   
   Result: Student MUST pay $150 (arrears) + $120 (new fee) = $270 total

5. IMPORTANT: Balances are NOT reset
   âœ“ Old payment history preserved
   âœ“ StudentBalance records for 2026 remain in database
   âœ“ 2027 StudentBalance includes 2026 arrears
   âœ“ Payment tracking shows complete history


EXAMPLE SCENARIO:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Year 2026 - Audrey Buwa:

Term 1 2026:
  Fee: $120
  Paid: $50
  Balance: $70 ğŸ”´

Term 2 2026:
  Fee: $200
  Paid: $200
  Balance: $0 ğŸŸ¢

Term 3 2026:
  Fee: $180
  Paid: $100
  Balance: $80 ğŸ”´

END OF 2026 TOTAL: Audrey owes $150 in arrears


ROLLOVER TO 2027:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Year Rollover Executed                   â”‚
â”‚ 2026 â†’ 2027                              â”‚
â”‚                                          â”‚
â”‚ âœ“ 2027 Academic Year created            â”‚
â”‚ âœ“ All 14 classes created                â”‚
â”‚ âœ“ Students promoted (Grade 1Aâ†’2A)       â”‚
â”‚ âœ“ Arrears calculated: $150              â”‚
â”‚ âœ“ StudentBalance created for 2027       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Term 1 2027 - Audrey Buwa (now Grade 2A):

Fee: $120 (new year fee)
Previous Arrears: $150 (from 2026) âš ï¸
Amount Paid: $0 (fresh start)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Current Balance: $270 ğŸ”´

Message: "Audrey owes $150 from last year PLUS $120 this year"


Database Records:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

StudentBalance 2026 (History - Preserved):
  Term 1 2026: Fee $120, Paid $50, Balance $70
  Term 2 2026: Fee $200, Paid $200, Balance $0
  Term 3 2026: Fee $180, Paid $100, Balance $80

StudentBalance 2027 (Current):
  Term 1 2027: Fee $120, Previous Arrears $150, Paid $0, Balance $270

Payment Records (Complete History):
  2026-01-15: $50 payment (Term 1)
  2026-04-10: $200 payment (Term 2)
  2026-07-05: $100 payment (Term 3)
  2027-01-20: $270 payment (Term 1) â† New payment


WHAT HAPPENS WHEN RECORDING PAYMENTS:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

When Audrey makes a $270 payment in 2027:

1. StudentBalance for Term 1 2027 updated:
   Amount Paid: $0 â†’ $270
   Current Balance: $270 â†’ $0

2. $270 covers:
   - $150 (previous year arrears)
   - $120 (current term fee)
   âœ“ Now fully paid!

3. If Audrey pays only $200:
   Amount Paid: $0 â†’ $200
   Current Balance: $270 â†’ $70
   âœ“ $70 remains due


DATABASE INTEGRITY:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âœ“ 2026 records NEVER deleted or modified
âœ“ Complete history available for reporting
âœ“ Financial audit trail preserved
âœ“ Each year's arrears properly calculated
âœ“ No data loss during rollover


THE CALCULATION IS IN:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

File: core/models/academic_year.py
Method: rollover_to_new_year()

Key calculation:
    total_arrears = StudentBalance.objects.filter(
        student=student,
        term__academic_year=self.year  â† PREVIOUS YEAR
    ).aggregate(
        total=Sum(F('term_fee') + F('previous_arrears') - F('amount_paid'))
    )['total'] or 0

Then stored:
    StudentBalance.objects.create(
        student=student,
        term=first_term,
        term_fee=term_fee.amount,
        previous_arrears=total_arrears,  â† CARRIED FORWARD âœ“
        amount_paid=0
    )


SUMMARY:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

âœ“ Balances are PRESERVED across years
âœ“ NOT reset or deleted
âœ“ Old records kept for history
âœ“ Arrears calculated and carried forward
âœ“ Students see complete debt picture
âœ“ Finance team can audit everything
âœ“ System tracks all payments ever made

BALANCES NEVER RESET - THEY GROW OR DIMINISH BASED ON PAYMENTS! âœ“
